# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0

name                collectd
description         flexible daemon periodically collecting system statistics data
long_description    \
    collectd is a daemon which collects system performance statistics \
    periodically and provides mechanisms to store the values in a variety of \
    ways, for example in RRD files.

homepage            http://collectd.org/
master_sites        http://collectd.org/files/
use_bzip2           yes
version             5.0.3
checksums           rmd160  aa33a349a82c63c6afc06ce0dbbd419175e42e45 \
                    sha256  563d75c9b0a642077785a9f48424765c4d354b9fd69d4fa9e906ff3fd321736d

categories          sysutils net
platforms           darwin
license             GPL-2

maintainers         cal openmaintainer

patchfiles          patch-src-network.c.patch \
                    patch-src-Makefile.am.patch

use_automake        yes

# enable all matches and targets, disable all the rest
configure.args      \
    --enable-match_empty_counter \
    --enable-match_hashed \
    --enable-match_regex \
    --enable-match_timediff \
    --enable-match_value \
    --enable-target_notification \
    --enable-target_replace \
    --enable-target_scale \
    --enable-target_set \
    --enable-target_v5upgrade \
    --disable-mbmon \
    --disable-amqp \
    --disable-apache \
    --disable-apcups \
    --disable-apple_sensors \
    --disable-ascent \
    --disable-battery \
    --disable-bind \
    --disable-conntrack \
    --disable-contextswitch \
    --disable-cpufreq \
    --disable-cpu \
    --disable-csv \
    --disable-curl \
    --disable-curl_json \
    --disable-curl_xml \
    --disable-dbi \
    --disable-df \
    --disable-disk \
    --disable-dns \
    --disable-email \
    --disable-entropy \
    --disable-exec \
    --disable-filecount \
    --disable-fscache \
    --disable-gmond \
    --disable-hddtemp \
    --disable-interface \
    --disable-ipmi \
    --disable-iptables \
    --disable-ipvs \
    --disable-irq \
    --disable-java \
    --disable-libvirt \
    --disable-load \
    --disable-logfile \
    --disable-lpar \
    --disable-madwifi \
    --disable-memcachec \
    --disable-memcached \
    --disable-memory \
    --disable-modbus \
    --disable-multimeter \
    --disable-mysql \
    --disable-netapp \
    --disable-netlink \
    --disable-network \
    --disable-nfs \
    --disable-nginx \
    --disable-notify_desktop \
    --disable-notify_email \
    --disable-ntpd \
    --disable-nut \
    --disable-olsrd \
    --disable-onewire \
    --disable-openvpn \
    --disable-oracle \
    --disable-perl \
    --disable-pinba \
    --disable-ping \
    --disable-postgresql \
    --disable-powerdns \
    --disable-processes \
    --disable-protocols \
    --disable-python \
    --disable-redis \
    --disable-routeros \
    --disable-rrdcached \
    --disable-rrdtool \
    --disable-sensors \
    --disable-serial \
    --disable-snmp \
    --disable-swap \
    --disable-syslog \
    --disable-table \
    --disable-tail \
    --disable-tape \
    --disable-tcpconns \
    --disable-teamspeak2 \
    --disable-ted \
    --disable-thermal \
    --disable-threshold \
    --disable-tokyotyrant \
    --disable-unixsock \
    --disable-uptime \
    --disable-users \
    --disable-uuid \
    --disable-varnish \
    --disable-vmem \
    --disable-vserver \
    --disable-wireless \
    --disable-write_http \
    --disable-write_redis \
    --disable-xmms \
    --disable-zfs_arc

#######################################################
# WARNING: This list is generated by files/dep-gen.sh #
#          Take care when editing manually!           #
#######################################################

variant hddtemp description {Query hddtempd} {
    configure.args-delete --disable-hddtemp
    configure.args-append --enable-hddtemp
}

variant exec description {Execution of external programs} {
    configure.args-delete --disable-exec
    configure.args-append --enable-exec
}

variant uptime description {Uptime statistics} {
    configure.args-delete --disable-uptime
    configure.args-append --enable-uptime
}

variant nginx description {nginx statistics} {
    configure.args-delete --disable-nginx
    configure.args-append --enable-nginx

    depends_lib-delete port:curl
    depends_lib-append port:curl
}

variant xmms description {XMMS statistics} {
    configure.args-delete --disable-xmms
    configure.args-append --enable-xmms

    depends_lib-delete port:xmms
    depends_lib-append port:xmms
}

variant mbmon description {Query mbmond} {
    configure.args-delete --disable-mbmon
    configure.args-append --enable-mbmon
}

variant gmond description {Ganglia plugin} {
    configure.args-delete --disable-gmond
    configure.args-append --enable-gmond

    depends_lib-delete port:ganglia
    depends_lib-append port:ganglia
}

variant tail description {Parsing of logfiles} {
    configure.args-delete --disable-tail
    configure.args-append --enable-tail
}

variant notify_desktop description {Desktop notifications} {
    configure.args-delete --disable-notify_desktop
    configure.args-append --enable-notify_desktop

    depends_lib-delete port:libnotify
    depends_lib-append port:libnotify
}

variant df description {Filesystem usage statistics} {
    configure.args-delete --disable-df
    configure.args-append --enable-df
}

variant perl description {Embed a Perl interpreter} {
    configure.args-delete --disable-perl
    configure.args-append --enable-perl

    pre-configure {
        set perl5bin "${prefix}/bin/perl5"
        if {[string first "true" [exec ${perl5bin} -V:useshrplib]] == -1} {
            ui_error "${name} requires perl5 to be installed with the +shared variant."
            return -code error "perl5 must be +shared"
        }
        if {[string first "define" [exec ${perl5bin} -V:usethreads]] == -1} {
            ui_error "${name} requires perl5 to be installed with the +threads variant."
            return -code error "perl5 must be +threads"
        }
    }

    depends_lib-delete port:perl5.12
    depends_lib-append port:perl5.12
}

variant table description {Parsing of tabular data} {
    configure.args-delete --disable-table
    configure.args-append --enable-table
}

variant logfile description {File logging plugin} {
    configure.args-delete --disable-logfile
    configure.args-append --enable-logfile
}

variant bind description {ISC Bind nameserver statistics} {
    configure.args-delete --disable-bind
    configure.args-append --enable-bind

    depends_lib-delete port:curl port:libxml2
    depends_lib-append port:curl port:libxml2
}

variant postgresql description {PostgreSQL database statistics} {
    configure.args-delete --disable-postgresql
    configure.args-append --enable-postgresql

    depends_lib-delete port:postgresql91
    depends_lib-append port:postgresql91
}

variant openvpn description {OpenVPN client statistics} {
    configure.args-delete --disable-openvpn
    configure.args-append --enable-openvpn
}

variant apcups description {Statistics of UPSes by APC} {
    configure.args-delete --disable-apcups
    configure.args-append --enable-apcups
}

variant swap description {Swap usage statistics} {
    configure.args-delete --disable-swap
    configure.args-append --enable-swap
}

variant interface description {Interface traffic statistics} {
    configure.args-delete --disable-interface
    configure.args-append --enable-interface
}

variant contextswitch description {context switch statistics} {
    configure.args-delete --disable-contextswitch
    configure.args-append --enable-contextswitch
}

variant tcpconns description {TCP connection statistics} {
    configure.args-delete --disable-tcpconns
    configure.args-append --enable-tcpconns
}

variant load description {System load} {
    configure.args-delete --disable-load
    configure.args-append --enable-load
}

variant dns description {DNS traffic analysis} {
    configure.args-delete --disable-dns
    configure.args-append --enable-dns

    depends_lib-delete port:libpcap
    depends_lib-append port:libpcap
}

variant email description {EMail statistics} {
    configure.args-delete --disable-email
    configure.args-append --enable-email
}

variant ntpd description {NTPd statistics} {
    configure.args-delete --disable-ntpd
    configure.args-append --enable-ntpd
}

variant ascent description {AscentEmu player statistics} {
    configure.args-delete --disable-ascent
    configure.args-append --enable-ascent

    depends_lib-delete port:curl port:libxml2
    depends_lib-append port:curl port:libxml2
}

variant ted description {Read The Energy Detective values} {
    configure.args-delete --disable-ted
    configure.args-append --enable-ted
}

variant teamspeak2 description {TeamSpeak2 server statistics} {
    configure.args-delete --disable-teamspeak2
    configure.args-append --enable-teamspeak2
}

variant curl_json description {CouchDB statistics} {
    configure.args-delete --disable-curl_json
    configure.args-append --enable-curl_json

    depends_lib-delete port:curl port:yajl
    depends_lib-append port:curl port:yajl
}

variant java description {Embed the Java Virtual Machine} {
    configure.args-delete --disable-java
    configure.args-append --enable-java

    pre-configure {
        ui_warn "Compiling with Java will probably fail; if you want to make it work, read `Configuring with libjvm' in README in the upstream git"
    }
}

variant uuid description {UUID as hostname plugin} {
    configure.args-delete --disable-uuid
    configure.args-append --enable-uuid
}

variant threshold description {Threshold checking plugin} {
    configure.args-delete --disable-threshold
    configure.args-append --enable-threshold
}

variant olsrd description {olsrd statistics} {
    configure.args-delete --disable-olsrd
    configure.args-append --enable-olsrd
}

variant network description {Network communication plugin} {
    configure.args-delete --disable-network
    configure.args-append --enable-network

    # silence a deprecation warning
    configure.cflags-append -D_GCRYPT_IN_LIBGCRYPT=1

    depends_lib-delete port:libgcrypt
    depends_lib-append port:libgcrypt
}

variant dbi description {General database statistics} {
    configure.args-delete --disable-dbi
    configure.args-append --enable-dbi

    depends_lib-delete port:libdbi
    depends_lib-append port:libdbi
}

variant curl_xml description {CURL generic xml statistics} {
    configure.args-delete --disable-curl_xml
    configure.args-append --enable-curl_xml

    depends_lib-delete port:curl port:libxml2
    depends_lib-append port:curl port:libxml2
}

variant multimeter description {Read multimeter values} {
    configure.args-delete --disable-multimeter
    configure.args-append --enable-multimeter
}

variant syslog description {Syslog logging plugin} {
    configure.args-delete --disable-syslog
    configure.args-append --enable-syslog
}

variant filecount description {Count files in directories} {
    configure.args-delete --disable-filecount
    configure.args-append --enable-filecount
}

variant snmp description {SNMP querying plugin} {
    configure.args-delete --disable-snmp
    configure.args-append --enable-snmp

    depends_lib-delete port:net-snmp
    depends_lib-append port:net-snmp
}

variant csv description {CSV output plugin} {
    configure.args-delete --disable-csv
    configure.args-append --enable-csv
}

variant unixsock description {Unixsock communication plugin} {
    configure.args-delete --disable-unixsock
    configure.args-append --enable-unixsock
}

variant curl description {CURL generic web statistics} {
    configure.args-delete --disable-curl
    configure.args-append --enable-curl

    depends_lib-delete port:curl
    depends_lib-append port:curl
}

variant disk description {Disk usage statistics} {
    configure.args-delete --disable-disk
    configure.args-append --enable-disk
}

variant write_http description {HTTP output plugin} {
    configure.args-delete --disable-write_http
    configure.args-append --enable-write_http

    depends_lib-delete port:curl
    depends_lib-append port:curl
}

variant users description {User statistics} {
    configure.args-delete --disable-users
    configure.args-append --enable-users
}

variant apple_sensors description {Apple's hardware sensors} {
    configure.args-delete --disable-apple_sensors
    configure.args-append --enable-apple_sensors
}

variant memory description {Memory usage} {
    configure.args-delete --disable-memory
    configure.args-append --enable-memory
}

variant mysql description {MySQL statistics} {
    configure.args-delete --disable-mysql
    configure.args-append --enable-mysql

    depends_lib-delete path:lib/mysql5/mysql/libmysqlclient.dylib:mysql5
    depends_lib-append path:lib/mysql5/mysql/libmysqlclient.dylib:mysql5
}

variant memcachec description {memcachec statistics} {
    configure.args-delete --disable-memcachec
    configure.args-append --enable-memcachec

    depends_lib-delete port:libmemcached
    depends_lib-append port:libmemcached
}

variant memcached description {memcached statistics} {
    configure.args-delete --disable-memcached
    configure.args-append --enable-memcached
}

variant lpar description {AIX logical partitions statistics} {
    configure.args-delete --disable-lpar
    configure.args-append --enable-lpar
}

variant rrdtool description {RRDTool output plugin} {
    configure.args-delete --disable-rrdtool
    configure.args-append --enable-rrdtool

    depends_lib-delete port:rrdtool
    depends_lib-append port:rrdtool
}

variant rrdcached description {RRDTool output plugin} {
    configure.args-delete --disable-rrdcached
    configure.args-append --enable-rrdcached

    depends_lib-delete port:rrdtool
    depends_lib-append port:rrdtool
}

variant powerdns description {PowerDNS statistics} {
    configure.args-delete --disable-powerdns
    configure.args-append --enable-powerdns
}

variant libvirt description {Virtual machine statistics} {
    configure.args-delete --disable-libvirt
    configure.args-append --enable-libvirt

    depends_lib-delete port:libvirt port:libxml2
    depends_lib-append port:libvirt port:libxml2
}

variant nut description {Network UPS tools statistics} {
    configure.args-delete --disable-nut
    configure.args-append --enable-nut

    depends_lib-delete port:nut
    depends_lib-append port:nut
}

variant notify_email description {Email notifier} {
    configure.args-delete --disable-notify_email
    configure.args-append --enable-notify_email

    depends_lib-delete port:libesmtp
    depends_lib-append port:libesmtp
}

variant python description {Embed a Python interpreter} {
    configure.args-delete --disable-python
    configure.args-append --enable-python

    depends_lib-delete port:python27
    depends_lib-append port:python27
}

variant cpu description {CPU usage statistics} {
    configure.args-delete --disable-cpu
    configure.args-append --enable-cpu
}

variant apache description {Apache httpd statistics} {
    configure.args-delete --disable-apache
    configure.args-append --enable-apache

    depends_lib-delete port:curl
    depends_lib-append port:curl
}

variant battery description {Battery statistics} {
    configure.args-delete --disable-battery
    configure.args-append --enable-battery
}

default_variants \
    +apache \
    +apcups \
    +apple_sensors \
    +battery \
    +bind \
    +contextswitch \
    +cpu \
    +csv \
    +curl \
    +curl_xml \
    +df \
    +disk \
    +email \
    +exec \
    +filecount \
    +hddtemp \
    +interface \
    +load \
    +logfile \
    +mbmon \
    +memcached \
    +memory \
    +multimeter \
    +network \
    +ntpd \
    +olsrd \
    +openvpn \
    +rrdcached \
    +rrdtool \
    +swap \
    +syslog \
    +table \
    +tail \
    +tcpconns \
    +teamspeak2 \
    +ted \
    +threshold \
    +unixsock \
    +uptime \
    +users \
    +uuid \
    +write_http \

